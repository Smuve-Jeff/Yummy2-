<div class="w-full p-4 flex flex-col gap-4 relative min-h-[600px]"
  [class]="'text-' + theme().neutral + '-200'"
  [class]="'bg-' + theme().purple + '-900/50'"
  [class]="'border border-' + theme().purple + '-500/30'">
  <h2 class="text-center text-lg" [class]="'text-' + theme().purple + '-400'">[ AURA VIDEO LAB ]</h2>

  @if (error()) {
    <div class="bg-red-900/50 text-red-300 p-3 text-center border border-red-500 animate-fade-in">
      {{ error() }}
    </div>
  }

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-grow">
    <!-- Camera & Recording -->
    <div class="flex flex-col gap-4 p-4"
      [class]="'border border-' + theme().purple + '-500/20'">
      <h3 class="text-base" [class]="'text-' + theme().purple + '-300'">// CAMERA & RECORDING</h3>
      <div class="flex-grow flex items-center justify-center border-2 border-dashed p-2 min-h-[200px] overflow-hidden bg-black relative"
        [class]="'border-' + theme().purple + '-700/50'">
        <video #liveVideoPreview class="max-w-full max-h-full object-contain" autoplay muted playsinline></video>
        @if (!isCameraActive()) {
          <span class="absolute text-sm" [class]="'text-' + theme().neutral + '-500'">[ Camera Off ]</span>
        }
        @if (isRecording()) {
          <span class="absolute top-2 left-2 text-red-500 animate-pulse text-sm flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-red-500"></span> REC: {{ formatTime(recordingTime()) }}
          </span>
        }
      </div>

      <div class="flex gap-2">
        <button (click)="toggleCamera()"
          class="flex-grow px-4 py-2 border-2 text-lg"
          [class]="'border-' + theme().purple + '-500'"
          [class]="'bg-' + theme().purple + '-800'"
          [class]="'text-' + theme().purple + '-300'"
          [class]="'hover:bg-' + theme().purple + '-500'"
          [class]="'hover:text-black'"
          [disabled]="isRecording()">
          @if (isCameraActive()) {
            <span>[ DISABLE CAMERA ]</span>
          } @else {
            <span>[ ENABLE CAMERA ]</span>
          }
        </button>
      </div>
      <div class="flex gap-2">
         <button (click)="startRecording()"
            class="flex-grow px-4 py-2 border-2 text-lg"
            [class]="'border-' + theme().primary + '-500'"
            [class]="'bg-' + theme().primary + '-800'"
            [class]="'text-' + theme().primary + '-300'"
            [class]="'hover:bg-' + theme().primary + '-500'"
            [class]="'hover:text-black'"
            [disabled]="isRecording() || !isCameraActive()">
            @if (isRecording()) {
              <span>[ RECORDING... ]</span>
            } @else {
              <span>[ START RECORDING ]</span>
            }
          </button>
          <button (click)="stopRecording()"
            class="px-4 py-2 border-2 text-lg"
            [class]="'border-' + theme().red + '-500'"
            [class]="'bg-' + theme().red + '-800'"
            [class]="'text-' + theme().red + '-300'"
            [class]="'hover:bg-' + theme().red + '-500'"
            [class]="'hover:text-black'"
            [disabled]="!isRecording()">
            [ STOP ]
          </button>
      </div>

      <!-- Recorded Video Preview -->
      @if (recordedVideoUrl()) {
        <h3 class="text-base mt-4" [class]="'text-' + theme().purple + '-300'">// RECORDED VIDEO</h3>
        <div class="flex items-center justify-center border-2 border-dashed p-2 min-h-[200px] overflow-hidden bg-black"
          [class]="'border-' + theme().purple + '-700/50'">
          <video #recordedVideoPlayer [src]="recordedVideoUrl()" controls class="max-w-full max-h-full object-contain"></video>
        </div>
        <a [href]="recordedVideoUrl()!" download="aura-recorded-video.webm"
           class="w-full text-center px-4 py-2 border-2 hover:text-black text-lg"
           [class]="'border-' + theme().purple + '-500'"
           [class]="'bg-' + theme().purple + '-800'"
           [class]="'text-' + theme().purple + '-300'"
           [class]="'hover:bg-' + theme().purple + '-500'">
           [ DOWNLOAD RECORDED VIDEO ]
        </a>
      }
    </div>

    <!-- AI Video Generation -->
    <div class="flex flex-col gap-4 p-4"
      [class]="'border border-' + theme().purple + '-500/20'">
      <h3 class="text-base" [class]="'text-' + theme().purple + '-300'">// AI VIDEO GENERATION</h3>
      @if (imageForVideoGeneration()) {
        <div class="flex flex-col items-center gap-2">
          <h4 class="text-sm" [class]="'text-' + theme().neutral + '-400'">// IMAGE INPUT FROM EDITOR</h4>
          <img [src]="imageForVideoGeneration()!" alt="Image from editor" class="w-24 h-24 object-cover border"
            [class]="'border-' + theme().neutral + '-600'">
        </div>
      }
      <label for="video-prompt" class="block text-sm" [class]="'text-' + theme().purple + '-300'">VIDEO PROMPT:</label>
      <textarea id="video-prompt"
        [value]="videoPrompt()"
        (input)="videoPrompt.set($event.target.value)"
        placeholder="e.g., 'A neon hologram of a cat driving at top speed', 'A futuristic city at sunset with flying cars and towering skyscrapers.'"
        rows="4"
        class="w-full p-2 text-sm focus:ring-500 resize-y"
        [class]="'bg-' + theme().purple + '-800/50'"
        [class]="'border-' + theme().purple + '-500/50'"
        [class]="'text-' + theme().neutral + '-200'"
        [class]="'focus:ring-' + theme().purple + '-500'"
        [class]="'focus:border-' + theme().purple + '-500'"
        [disabled]="isGeneratingVideo() || !isAiAvailable()"></textarea>

      <!-- Aspect Ratio Selection -->
      <label class="block text-sm mt-2" [class]="'text-' + theme().purple + '-300'">ASPECT RATIO:</label>
      <div class="flex flex-wrap gap-2 text-sm">
        @for (ratio of ['1:1', '4:3', '3:4', '16:9', '9:16']; track ratio) {
          <button type="button" (click)="aspectRatio.set(ratio)"
            class="px-3 py-1 border"
            [class]="'border-' + theme().purple + '-500/50'"
            [class]="aspectRatio() === ratio ? 'bg-' + theme().purple + '-500 text-black' : 'hover:bg-' + theme().purple + '-700/50'"
            [disabled]="isGeneratingVideo() || !isAiAvailable()">
            {{ ratio }}
          </button>
        }
      </div>

      <div class="flex flex-col gap-2 mt-4">
        <button (click)="generateVideo(false)"
          class="flex-grow px-4 py-2 border-2 text-lg"
          [class]="'border-' + theme().purple + '-500'"
          [class]="'bg-' + theme().purple + '-800'"
          [class]="'text-' + theme().purple + '-300'"
          [class]="'hover:bg-' + theme().purple + '-500'"
          [class]="'hover:text-black'"
          [disabled]="!videoPrompt() || isGeneratingVideo() || !isAiAvailable()">
          @if (isGeneratingVideo()) {
            <span>[ GENERATING... ]</span>
          } @else {
            <span>[ GENERATE FROM PROMPT ]</span>
          }
        </button>
        @if (imageForVideoGeneration()) {
          <button (click)="generateVideo(true)"
            class="flex-grow px-4 py-2 border-2 text-lg"
            [class]="'border-' + theme().purple + '-500'"
            [class]="'bg-' + theme().purple + '-800'"
            [class]="'text-' + theme().purple + '-300'"
            [class]="'hover:bg-' + theme().purple + '-500'"
            [class]="'hover:text-black'"
            [disabled]="!videoPrompt() || isGeneratingVideo() || !isAiAvailable()">
            @if (isGeneratingVideo()) {
              <span>[ GENERATING... ]</span>
            } @else {
              <span>[ GENERATE FROM IMAGE + PROMPT ]</span>
            }
          </button>
        }
      </div>

      @if (generationProgressMessage()) {
        <p class="text-sm mt-2 text-center animate-pulse" [class]="'text-' + theme().neutral + '-400'">{{ generationProgressMessage() }}</p>
      }

      <!-- Generated Video Display -->
      @if (generatedVideoUrl()) {
        <h3 class="text-base mt-4" [class]="'text-' + theme().purple + '-300'">// GENERATED AI VIDEO</h3>
        <div class="flex items-center justify-center border-2 border-dashed p-2 min-h-[200px] overflow-hidden bg-black"
          [class]="'border-' + theme().purple + '-700/50'">
          <video [src]="generatedVideoUrl()!" controls autoplay loop muted playsinline class="max-w-full max-h-full object-contain"></video>
        </div>
        <a [href]="generatedVideoUrl()!" download="aura-ai-generated-video.mp4"
           class="w-full text-center px-4 py-2 border-2 hover:text-black text-lg"
           [class]="'border-' + theme().purple + '-500'"
           [class]="'bg-' + theme().purple + '-800'"
           [class]="'text-' + theme().purple + '-300'"
           [class]="'hover:bg-' + theme().purple + '-500'">
           [ DOWNLOAD AI VIDEO ]
        </a>
      }
    </div>
  </div>

  <div class="flex justify-center mt-4">
    <button (click)="clearAll()"
      class="px-6 py-2 border-2 text-lg"
      [class]="'border-' + theme().neutral + '-500'"
      [class]="'bg-' + theme().neutral + '-800'"
      [class]="'text-' + theme().neutral + '-300'"
      [class]="'hover:bg-' + theme().neutral + '-500'"
      [class]="'hover:text-black'">
      [ CLEAR ALL ]
    </button>
  </div>
</div>